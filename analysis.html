<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì„ëŒ€ ì „ëµ ë¶„ì„ - ê´‘ì§„êµ¬</title>
    <style>
        :root {
            --primary: #2563eb;
            --primary-light: #3b82f6;
            --bg: #f8fafc;
            --card: #ffffff;
            --text: #1e293b;
            --text-muted: #64748b;
            --border: #e2e8f0;
            --success: #10b981;
            --warning: #f59e0b;
        }
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: 'Pretendard', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            background: var(--bg);
            min-height: 100vh;
            color: var(--text);
            padding: 20px;
            line-height: 1.6;
        }
        .container { max-width: 1400px; margin: 0 auto; }

        .nav { display: flex; gap: 10px; margin-bottom: 30px; flex-wrap: wrap; }
        .nav a {
            padding: 10px 20px;
            background: var(--card);
            border: 1px solid var(--border);
            border-radius: 8px;
            color: var(--text-muted);
            text-decoration: none;
            font-size: 0.9rem;
            transition: all 0.2s;
        }
        .nav a:hover, .nav a.active {
            background: var(--primary);
            border-color: var(--primary);
            color: #fff;
        }

        header {
            text-align: center;
            margin-bottom: 30px;
            padding: 30px;
            background: var(--card);
            border-radius: 16px;
            border: 1px solid var(--border);
        }
        h1 {
            font-size: 1.8rem;
            color: var(--text);
            margin-bottom: 10px;
            font-weight: 700;
        }
        .subtitle { color: var(--text-muted); font-size: 0.95rem; }

        .grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 20px;
            margin-bottom: 25px;
        }
        .grid-full { grid-column: 1 / -1; }

        .card {
            background: var(--card);
            border: 1px solid var(--border);
            border-radius: 12px;
            padding: 24px;
        }
        .card h2 {
            font-size: 1rem;
            color: var(--text);
            margin-bottom: 20px;
            padding-bottom: 12px;
            border-bottom: 1px solid var(--border);
            display: flex;
            align-items: center;
            gap: 10px;
            font-weight: 600;
        }

        /* ìš”ì•½ ì¹´ë“œ */
        .summary-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
            gap: 12px;
        }
        .summary-item {
            background: var(--bg);
            border-radius: 10px;
            padding: 16px;
            text-align: center;
        }
        .summary-item .value {
            font-size: 1.6rem;
            font-weight: 700;
            color: var(--primary);
        }
        .summary-item .label {
            font-size: 0.75rem;
            color: var(--text-muted);
            margin-top: 4px;
        }
        .summary-item.green .value { color: var(--success); }
        .summary-item.purple .value { color: #7c3aed; }
        .summary-item.yellow .value { color: var(--warning); }

        /* ë™ë³„ ë¹„êµ ë°” */
        .dong-bar {
            margin: 10px 0;
        }
        .dong-bar-header {
            display: flex;
            justify-content: space-between;
            margin-bottom: 6px;
            font-size: 0.9rem;
        }
        .dong-bar-track {
            height: 28px;
            background: var(--bg);
            border-radius: 6px;
            overflow: hidden;
            display: flex;
        }
        .dong-bar-fill {
            height: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.75rem;
            font-weight: 600;
            color: #fff;
            transition: width 0.5s;
        }
        .bar-10plus { background: var(--success); }
        .bar-5plus { background: var(--primary); }
        .bar-5minus { background: #7c3aed; }

        /* ì¶”ì²œ ì¤‘ê°œì‚¬ */
        .broker-card {
            display: flex;
            align-items: center;
            gap: 14px;
            padding: 14px;
            margin: 8px 0;
            background: var(--bg);
            border-radius: 10px;
            border-left: 3px solid var(--success);
            transition: all 0.2s;
        }
        .broker-card:hover {
            background: rgba(16, 185, 129, 0.1);
            transform: translateX(3px);
        }
        .broker-rank {
            width: 30px;
            height: 30px;
            background: rgba(245, 158, 11, 0.1);
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            color: var(--warning);
            font-size: 0.9rem;
        }
        .broker-info { flex: 1; }
        .broker-name { font-weight: 600; margin-bottom: 2px; }
        .broker-meta { font-size: 0.8rem; color: var(--text-muted); }
        .broker-badges { display: flex; gap: 6px; }
        .badge {
            padding: 3px 8px;
            border-radius: 10px;
            font-size: 0.7rem;
            font-weight: 600;
        }
        .badge-years { background: rgba(16, 185, 129, 0.1); color: var(--success); }
        .badge-excellent { background: rgba(245, 158, 11, 0.1); color: var(--warning); }
        .badge-electronic { background: rgba(37, 99, 235, 0.1); color: var(--primary); }

        /* ì „ëµ */
        .strategy-box {
            padding: 20px;
            border-radius: 12px;
            margin: 10px 0;
        }
        .strategy-box.recommended {
            background: rgba(16, 185, 129, 0.05);
            border: 2px solid var(--success);
        }
        .strategy-box.alternative {
            background: var(--bg);
            border: 1px solid var(--border);
        }
        .strategy-title {
            font-weight: 600;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        .strategy-title .tag {
            background: var(--success);
            color: #fff;
            padding: 2px 8px;
            border-radius: 10px;
            font-size: 0.7rem;
        }
        .strategy-content { font-size: 0.9rem; color: var(--text-muted); line-height: 1.7; }
        .strategy-content strong { color: var(--text); }

        /* ì²´í¬ë¦¬ìŠ¤íŠ¸ */
        .checklist { margin-top: 10px; }
        .check-item {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 12px 14px;
            margin: 6px 0;
            background: var(--bg);
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.2s;
        }
        .check-item:hover { background: rgba(37,99,235,0.05); }
        .checkbox {
            width: 22px;
            height: 22px;
            border: 2px solid var(--primary);
            border-radius: 5px;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s;
            flex-shrink: 0;
        }
        .check-item.checked .checkbox {
            background: var(--primary);
        }
        .check-item.checked .checkbox::after {
            content: 'âœ“';
            color: #fff;
            font-size: 12px;
        }
        .check-item.checked .check-text {
            text-decoration: line-through;
            color: var(--text-muted);
        }
        .check-text { font-size: 0.9rem; }

        /* ë¡œë“œë§µ */
        .roadmap-item {
            padding: 18px;
            margin: 10px 0;
            border-radius: 12px;
            border-left: 4px solid;
            background: var(--bg);
        }
        .roadmap-item.phase-1 { border-color: var(--success); }
        .roadmap-item.phase-2 { border-color: var(--primary); }
        .roadmap-item.phase-3 { border-color: var(--warning); }
        .roadmap-item.phase-4 { border-color: #ef4444; }
        .roadmap-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 8px;
        }
        .roadmap-title { font-weight: 600; }
        .roadmap-time { font-size: 0.8rem; color: var(--text-muted); }
        .roadmap-content { font-size: 0.85rem; color: var(--text-muted); }

        footer {
            text-align: center;
            padding: 30px;
            color: var(--text-muted);
            font-size: 0.85rem;
            margin-top: 30px;
        }

        @media (max-width: 768px) {
            .grid { grid-template-columns: 1fr; }
            .summary-grid { grid-template-columns: repeat(2, 1fr); }
        }
    </style>
</head>
<body>
    <div class="container">
        <nav class="nav">
            <a href="index.html">ì‹¤ì‹œê°„ ì‹œì„¸</a>
            <a href="broker.html">ê³µì¸ì¤‘ê°œì‚¬</a>
            <a href="analysis.html" class="active">ì„ëŒ€ ë¶„ì„</a>
            <a href="report.html">ì „ëµ ë³´ê³ ì„œ</a>
        </nav>

        <header>
            <h1>ê´‘ì§„êµ¬ ì„ëŒ€ ì „ëµ ë¶„ì„</h1>
            <p class="subtitle">893ê°œ ì¤‘ê°œì‚¬ ë°ì´í„° ê¸°ë°˜ ì¢…í•© ë¶„ì„ ë¦¬í¬íŠ¸</p>
        </header>

        <!-- ì‹œì„¸ ìš”ì•½ -->
        <div class="grid">
            <div class="card grid-full">
                <h2>ğŸ’° ìì–‘ì—­ ì¸ê·¼ ì‹¤ì œ ì‹œì„¸ (2ì¸µ ì´ìƒ, N=20)</h2>
                <div class="summary-grid">
                    <div class="summary-item">
                        <div class="value">3.6~17.1</div>
                        <div class="label">í‰ë‹¹ ì›”ì„¸ ë²”ìœ„ (ë§Œì›)</div>
                    </div>
                    <div class="summary-item green">
                        <div class="value">6.2</div>
                        <div class="label">ì¤‘ì•™ê°’ (ë§Œì›/í‰)</div>
                    </div>
                    <div class="summary-item purple">
                        <div class="value">3.6~16.4</div>
                        <div class="label">ê±°ë˜ì™„ë£Œ ë²”ìœ„ (10ê±´)</div>
                    </div>
                    <div class="summary-item yellow">
                        <div class="value">17.1</div>
                        <div class="label">ìµœê³ ê°€ (Outlier)</div>
                    </div>
                </div>
                <div style="margin-top: 20px; padding: 16px; background: rgba(239, 68, 68, 0.05); border-radius: 10px; border-left: 3px solid #ef4444;">
                    <div style="font-weight: 600; margin-bottom: 8px; color: #ef4444;">âš ï¸ í˜„ì‹¤ì ì¸ ê¸°ëŒ€ì¹˜</div>
                    <div style="font-size: 0.9rem; color: #64748b; line-height: 1.7;">
                        2ì¸µ ì´ìƒ ê¸°ì¤€, ê±°ë˜ ì™„ë£Œ 10ê±´ì˜ ë²”ìœ„ëŠ” <strong style="color: #1e293b;">í‰ë‹¹ 3.6~16.4ë§Œì›</strong>.<br>
                        41í‰ ê¸°ì¤€ ì¤‘ì•™ê°’ ì•½ <strong style="color: #1e293b;">250ë§Œì›</strong>, í˜‘ìƒ ë²”ìœ„ <strong style="color: #1e293b;">200~350ë§Œì›</strong> ìˆ˜ì¤€ì´ í˜„ì‹¤ì .<br>
                        17.1ë§Œì›/í‰ì€ íŠ¹ìˆ˜ ì¼€ì´ìŠ¤(í”„ë¦¬ë¯¸ì—„ ì…ì§€)ë¡œ ì¼ë°˜ì  ê¸°ëŒ€ì¹˜ë¡œ ë³´ê¸° ì–´ë ¤ì›€.
                    </div>
                </div>
            </div>
        </div>

        <!-- ì¤‘ê°œì‚¬ ìš”ì•½ -->
        <div class="grid">
            <div class="card grid-full">
                <h2>ğŸ“Š ê´‘ì§„êµ¬ ì¤‘ê°œì‚¬ í˜„í™© ìš”ì•½</h2>
                <div class="summary-grid" id="summaryGrid"></div>
            </div>
        </div>

        <!-- ë™ë³„ ë¶„ì„ -->
        <div class="grid">
            <div class="card">
                <h2>ğŸ˜ï¸ ë™ë³„ ì¤‘ê°œì‚¬ ë¶„í¬</h2>
                <div id="dongDistribution"></div>
            </div>

            <div class="card">
                <h2>â­ ì¶”ì²œ ì¤‘ê°œì‚¬</h2>
                <p style="font-size: 0.85rem; color: #888; margin-bottom: 15px;">
                    ìì–‘ë™ ê¸°ì¤€ | ë‹¤ì–‘í•œ ê¸°ì¤€ìœ¼ë¡œ ë¶„ì„
                </p>

                <div style="margin-bottom: 20px;">
                    <div style="font-weight: 600; color: #10b981; margin-bottom: 10px; font-size: 0.9rem;">ğŸ“ˆ ì—…ë ¥ TOP 3</div>
                    <div id="topByYears"></div>
                </div>

                <div style="margin-bottom: 20px;">
                    <div style="font-weight: 600; color: #00d4ff; margin-bottom: 10px; font-size: 0.9rem;">ğŸ‘¥ ì†Œì†ì¸ì› TOP 3</div>
                    <div id="topByStaff"></div>
                </div>

                <div>
                    <div style="font-weight: 600; color: #f59e0b; margin-bottom: 10px; font-size: 0.9rem;">ğŸ† ì¢…í•© ì¶”ì²œ (ì—…ë ¥+ì¸ì›)</div>
                    <div id="topCombined"></div>
                </div>
            </div>
        </div>

        <!-- ì „ëµ ì œì•ˆ -->
        <div class="grid">
            <div class="card grid-full">
                <h2>ğŸ’¡ ì„ëŒ€ ì „ëµ ì œì•ˆ</h2>

                <div class="strategy-box recommended">
                    <div class="strategy-title">
                        <span>ì¶”ì²œ ì „ëµ: ê²½ë ¥ ìˆëŠ” ì¤‘ê°œì‚¬ ë³µìˆ˜ ì„ ì„</span>
                        <span class="tag">ì¶”ì²œ</span>
                    </div>
                    <div class="strategy-content">
                        <strong>10ë…„ ì´ìƒ</strong> ê²½ë ¥ì˜ ì¤‘ê°œì‚¬ <strong>2~3ê³³</strong>ì— ë™ì‹œ ì˜ë¢°í•˜ì„¸ìš”.<br>
                        ê´‘ì§„êµ¬ì—ëŠ” <strong id="veteran10Count">-</strong>ê°œì˜ 10ë…„+ ì¤‘ê°œì‚¬ê°€ ìˆìœ¼ë©°,
                        ì´ ì¤‘ <strong id="excellentCount">-</strong>ê°œê°€ ìš°ìˆ˜ì—…ì²´ ì¸ì¦ì„ ë°›ì•˜ìŠµë‹ˆë‹¤.<br>
                        <strong>ì „ìê³„ì•½</strong> ê°€ëŠ¥ ì—…ì²´ë¥¼ ì„ í˜¸í•˜ë©´ ê³„ì•½ ê³¼ì •ì´ í¸ë¦¬í•©ë‹ˆë‹¤.
                    </div>
                </div>

                <div class="strategy-box alternative">
                    <div class="strategy-title">ëŒ€ì•ˆ ì „ëµ: ì‹ ê·œ ì¤‘ê°œì‚¬ í™œìš©</div>
                    <div class="strategy-content">
                        5ë…„ ë¯¸ë§Œ ì‹ ê·œ ì¤‘ê°œì‚¬ëŠ” ì ê·¹ì ì¸ ì˜ì—…ìœ¼ë¡œ ë¹ ë¥¸ ì„ëŒ€ê°€ ê°€ëŠ¥í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.<br>
                        ë‹¨, ê²½í—˜ ë¶€ì¡±ìœ¼ë¡œ í˜‘ìƒë ¥ì´ ë‚®ì„ ìˆ˜ ìˆìœ¼ë‹ˆ <strong>ë³´ì¦ë³´í—˜ ê°€ì… ì—¬ë¶€</strong>ë¥¼ ë°˜ë“œì‹œ í™•ì¸í•˜ì„¸ìš”.
                    </div>
                </div>
            </div>
        </div>

        <!-- ì²´í¬ë¦¬ìŠ¤íŠ¸ & ë¡œë“œë§µ -->
        <div class="grid">
            <div class="card">
                <h2>âœ… ì¤‘ê°œì‚¬ ì„ ì • ì²´í¬ë¦¬ìŠ¤íŠ¸</h2>
                <div class="checklist">
                    <div class="check-item" onclick="this.classList.toggle('checked')">
                        <div class="checkbox"></div>
                        <span class="check-text">ì˜ì—…ê¸°ê°„ 10ë…„ ì´ìƒ í™•ì¸</span>
                    </div>
                    <div class="check-item" onclick="this.classList.toggle('checked')">
                        <div class="checkbox"></div>
                        <span class="check-text">ë³´ì¦ë³´í—˜ ê°€ì… ì—¬ë¶€ í™•ì¸</span>
                    </div>
                    <div class="check-item" onclick="this.classList.toggle('checked')">
                        <div class="checkbox"></div>
                        <span class="check-text">ìš°ìˆ˜ì—…ì²´ ì¸ì¦ ì—¬ë¶€ í™•ì¸</span>
                    </div>
                    <div class="check-item" onclick="this.classList.toggle('checked')">
                        <div class="checkbox"></div>
                        <span class="check-text">ì „ìê³„ì•½ ê°€ëŠ¥ ì—¬ë¶€ í™•ì¸</span>
                    </div>
                    <div class="check-item" onclick="this.classList.toggle('checked')">
                        <div class="checkbox"></div>
                        <span class="check-text">í•´ë‹¹ ë™ ì „ë¬¸ ì—¬ë¶€ í™•ì¸</span>
                    </div>
                    <div class="check-item" onclick="this.classList.toggle('checked')">
                        <div class="checkbox"></div>
                        <span class="check-text">ì¤‘ê°œìˆ˜ìˆ˜ë£Œ í˜‘ì˜</span>
                    </div>
                </div>
            </div>

            <div class="card">
                <h2>ğŸ“‹ ì„ëŒ€ ì§„í–‰ ë¡œë“œë§µ</h2>
                <div class="roadmap-item phase-1">
                    <div class="roadmap-header">
                        <span class="roadmap-title">1ë‹¨ê³„: ì¤‘ê°œì‚¬ ì„ ì •</span>
                        <span class="roadmap-time">1ì£¼ì°¨</span>
                    </div>
                    <div class="roadmap-content">
                        ì¶”ì²œ ì¤‘ê°œì‚¬ 3ê³³ ë°©ë¬¸ â†’ ì‹œì„¸ ìƒë‹´ â†’ ìµœì¢… 2ê³³ ì„ ì •
                    </div>
                </div>
                <div class="roadmap-item phase-2">
                    <div class="roadmap-header">
                        <span class="roadmap-title">2ë‹¨ê³„: ë§¤ë¬¼ ë“±ë¡</span>
                        <span class="roadmap-time">1~2ì£¼ì°¨</span>
                    </div>
                    <div class="roadmap-content">
                        ì ì • ì‹œì„¸ ì±…ì • â†’ ë„¤ì´ë²„/ì§ë°© ë“±ë¡ â†’ í™ë³´ ì‹œì‘
                    </div>
                </div>
                <div class="roadmap-item phase-3">
                    <div class="roadmap-header">
                        <span class="roadmap-title">3ë‹¨ê³„: ë¬¸ì˜ ëŒ€ì‘</span>
                        <span class="roadmap-time">2~4ì£¼ì°¨</span>
                    </div>
                    <div class="roadmap-content">
                        ë¬¸ì˜ ì ‘ìˆ˜ â†’ í˜„ì¥ ì•ˆë‚´ â†’ ì¡°ê±´ í˜‘ì˜
                    </div>
                </div>
                <div class="roadmap-item phase-4">
                    <div class="roadmap-header">
                        <span class="roadmap-title">4ë‹¨ê³„: ê³„ì•½ ì²´ê²°</span>
                        <span class="roadmap-time">4ì£¼ì°¨~</span>
                    </div>
                    <div class="roadmap-content">
                        ì„ì°¨ì¸ ì‹ ìš© í™•ì¸ â†’ ê³„ì•½ì„œ ì‘ì„± â†’ ì”ê¸ˆ/ì…ì£¼
                    </div>
                </div>
            </div>
        </div>

        <footer>
            <p>ì„ëŒ€ ì „ëµ ë¶„ì„ | DOTS Project</p>
            <p style="margin-top: 5px;">ë°ì´í„° ì¶œì²˜: ì„œìš¸ì‹œ ë¶€ë™ì‚°ì •ë³´ê´‘ì¥ (893ê°œ ì¤‘ê°œì‚¬)</p>
        </footer>
    </div>

    <script>
        const DONGS = ['ìì–‘ë™', 'êµ¬ì˜ë™', 'ì¤‘ê³¡ë™', 'í™”ì–‘ë™', 'ê´‘ì¥ë™', 'êµ°ìë™', 'ëŠ¥ë™'];
        let brokerData = {};

        async function loadData() {
            try {
                const promises = DONGS.map(dong =>
                    fetch(`data/brokers/${dong}.json`).then(r => r.json())
                );
                const results = await Promise.all(promises);

                results.forEach(data => {
                    brokerData[data.dong] = data.brokers.map(b => ({
                        ...b,
                        dong: data.dong,
                        years: calcYears(b.regDate)
                    }));
                });

                renderAll();
            } catch (error) {
                console.error('ë°ì´í„° ë¡œë“œ ì‹¤íŒ¨:', error);
            }
        }

        function calcYears(regDate) {
            if (!regDate || regDate.length !== 8) return null;
            const year = parseInt(regDate.substring(0, 4));
            const month = parseInt(regDate.substring(4, 6));
            const day = parseInt(regDate.substring(6, 8));
            const reg = new Date(year, month - 1, day);
            const now = new Date();
            return Math.round((now - reg) / (1000 * 60 * 60 * 24 * 365) * 10) / 10;
        }

        function renderAll() {
            const allBrokers = Object.values(brokerData).flat();

            // ìš”ì•½
            const total = allBrokers.length;
            const active = allBrokers.filter(b => b.stsGbn === 'ì˜ì—…ì¤‘').length;
            const veteran10 = allBrokers.filter(b => b.years >= 10).length;
            const veteran15 = allBrokers.filter(b => b.years >= 15).length;
            const excellent = allBrokers.filter(b => b.exclncYn === 'Y').length;
            const electronic = allBrokers.filter(b => b.elctrnCntrctYn === 'Y').length;
            const withGuarantee = allBrokers.filter(b => b.guarantee === 'ìœ ').length;

            document.getElementById('summaryGrid').innerHTML = `
                <div class="summary-item">
                    <div class="value">${total}</div>
                    <div class="label">ì´ ì¤‘ê°œì‚¬</div>
                </div>
                <div class="summary-item green">
                    <div class="value">${active}</div>
                    <div class="label">ì˜ì—…ì¤‘</div>
                </div>
                <div class="summary-item green">
                    <div class="value">${veteran10}</div>
                    <div class="label">10ë…„+ ê²½ë ¥</div>
                </div>
                <div class="summary-item purple">
                    <div class="value">${veteran15}</div>
                    <div class="label">15ë…„+ ê²½ë ¥</div>
                </div>
                <div class="summary-item yellow">
                    <div class="value">${excellent}</div>
                    <div class="label">ìš°ìˆ˜ì—…ì²´</div>
                </div>
                <div class="summary-item">
                    <div class="value">${electronic}</div>
                    <div class="label">ì „ìê³„ì•½</div>
                </div>
            `;

            document.getElementById('veteran10Count').textContent = veteran10;
            document.getElementById('excellentCount').textContent = excellent;

            // ë™ë³„ ë¶„í¬
            const dongContainer = document.getElementById('dongDistribution');
            const maxCount = Math.max(...DONGS.map(d => (brokerData[d] || []).length));

            dongContainer.innerHTML = DONGS.map(dong => {
                const brokers = brokerData[dong] || [];
                const count10 = brokers.filter(b => b.years >= 10).length;
                const count5 = brokers.filter(b => b.years >= 5 && b.years < 10).length;
                const count0 = brokers.filter(b => b.years !== null && b.years < 5).length;
                const total = brokers.length;

                const pct10 = (count10 / maxCount * 100).toFixed(0);
                const pct5 = (count5 / maxCount * 100).toFixed(0);
                const pct0 = (count0 / maxCount * 100).toFixed(0);

                return `
                    <div class="dong-bar">
                        <div class="dong-bar-header">
                            <span><strong>${dong}</strong></span>
                            <span>${total}ê°œ</span>
                        </div>
                        <div class="dong-bar-track">
                            <div class="dong-bar-fill bar-10plus" style="width: ${pct10}%">${count10 > 5 ? count10 : ''}</div>
                            <div class="dong-bar-fill bar-5plus" style="width: ${pct5}%">${count5 > 5 ? count5 : ''}</div>
                            <div class="dong-bar-fill bar-5minus" style="width: ${pct0}%">${count0 > 5 ? count0 : ''}</div>
                        </div>
                    </div>
                `;
            }).join('');

            // ì¶”ì²œ ì¤‘ê°œì‚¬
            const jayangBrokers = brokerData['ìì–‘ë™'] || [];

            // ì—…ë ¥ TOP 3
            const topByYears = jayangBrokers
                .filter(b => b.stsGbn === 'ì˜ì—…ì¤‘')
                .sort((a, b) => (b.years || 0) - (a.years || 0))
                .slice(0, 3);

            // ì†Œì†ì¸ì› TOP 3
            const topByStaff = jayangBrokers
                .filter(b => b.stsGbn === 'ì˜ì—…ì¤‘')
                .sort((a, b) => (b.staffCount || 0) - (a.staffCount || 0))
                .slice(0, 3);

            // ì¢…í•© ì¶”ì²œ: ì—…ë ¥ 5ë…„+ AND ì†Œì†ì¸ì› 3ëª…+ ì¸ ì¤‘ê°œì‚¬ ì¤‘ ì¢…í•©ì ìˆ˜ ë†’ì€ ìˆœ
            const topCombined = jayangBrokers
                .filter(b => b.stsGbn === 'ì˜ì—…ì¤‘' && b.years >= 5 && (b.staffCount || 0) >= 3)
                .map(b => ({
                    ...b,
                    score: (b.years || 0) * 0.5 + (b.staffCount || 0) * 2 // ê°€ì¤‘ì¹˜ ì ìš©
                }))
                .sort((a, b) => b.score - a.score)
                .slice(0, 3);

            function renderBrokerCard(broker, idx, type) {
                const badges = [];
                if (type === 'years') {
                    badges.push(`<span class="badge badge-years">${broker.years?.toFixed(0)}ë…„</span>`);
                } else if (type === 'staff') {
                    badges.push(`<span class="badge" style="background: rgba(0,212,255,0.2); color: #00d4ff;">${broker.staffCount}ëª…</span>`);
                } else {
                    badges.push(`<span class="badge badge-years">${broker.years?.toFixed(0)}ë…„</span>`);
                    badges.push(`<span class="badge" style="background: rgba(0,212,255,0.2); color: #00d4ff;">${broker.staffCount}ëª…</span>`);
                }
                if (broker.exclncYn === 'Y') badges.push('<span class="badge badge-excellent">ìš°ìˆ˜</span>');
                if (broker.elctrnCntrctYn === 'Y') badges.push('<span class="badge badge-electronic">ì „ìê³„ì•½</span>');

                return `
                    <div class="broker-card">
                        <div class="broker-rank">${idx + 1}</div>
                        <div class="broker-info">
                            <div class="broker-name">${broker.cmpNm}</div>
                            <div class="broker-meta">${broker.rdealerNm} | ${broker.telno?.trim() || '-'}</div>
                        </div>
                        <div class="broker-badges">${badges.join('')}</div>
                    </div>
                `;
            }

            document.getElementById('topByYears').innerHTML = topByYears.map((b, i) => renderBrokerCard(b, i, 'years')).join('');
            document.getElementById('topByStaff').innerHTML = topByStaff.map((b, i) => renderBrokerCard(b, i, 'staff')).join('');
            document.getElementById('topCombined').innerHTML = topCombined.length > 0
                ? topCombined.map((b, i) => renderBrokerCard(b, i, 'combined')).join('')
                : '<div style="color: #666; font-size: 0.85rem; padding: 10px;">ì¡°ê±´ì— ë§ëŠ” ì¤‘ê°œì‚¬ê°€ ì—†ìŠµë‹ˆë‹¤.</div>';
        }

        loadData();
    </script>
</body>
</html>
